(function(t,a){(function(e){"function"==typeof define&&define.amd?define(["jquery"],e):jQuery&&!jQuery.fn.sparkline&&e(jQuery)})(function(r){'use strict';var e,i,n,l,o,s,g,p,d,h,u,c,f,m,v,x,y,C,R,S,b,w,k,M,_,H,W,T,j,q,I,P,L={},A=0;e=function(){return{common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:void 0,normalRangeMax:void 0,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:void 0,chartRangeMax:void 0,chartRangeMinX:void 0,chartRangeMaxX:void 0,tooltipFormat:new n("<span style=\"color: {{color}}\">&#9679;</span> {{prefix}}{{y}}{{suffix}}")},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:void 0,nullColor:void 0,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:void 0,chartRangeMin:void 0,chartRangeClip:!1,colorMap:void 0,tooltipFormat:new n("<span style=\"color: {{color}}\">&#9679;</span> {{prefix}}{{value}}{{suffix}}")},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new n("<span style=\"color: {{color}}\">&#9679;</span> {{value:map}}"),tooltipValueLookups:{map:{"-1":"Loss",0:"Draw",1:"Win"}}},discrete:{lineHeight:"auto",thresholdColor:void 0,thresholdValue:0,chartRangeMax:void 0,chartRangeMin:void 0,chartRangeClip:!1,tooltipFormat:new n("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:void 0,tooltipFormat:new n("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],borderWidth:0,borderColor:"#000",tooltipFormat:new n("<span style=\"color: {{color}}\">&#9679;</span> {{value}} ({{percent.1}}%)")},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:void 0,targetColor:"#4a2",chartRangeMax:void 0,chartRangeMin:void 0,tooltipFormat:new n("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}}},H=".jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: \"progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)\";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;box-sizing: content-box;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}",i=function(){var e,t;return e=function(){this.init.apply(this,arguments)},1<arguments.length?(arguments[0]?(e.prototype=r.extend(new arguments[0],arguments[arguments.length-1]),e._super=arguments[0].prototype):e.prototype=arguments[arguments.length-1],2<arguments.length&&(t=Array.prototype.slice.call(arguments,1,-1),t.unshift(e.prototype),r.extend.apply(r,t))):e.prototype=arguments[0],e.prototype.cls=e,e},r.SPFormatClass=n=i({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(e,t){this.format=e,this.fclass=t},render:function(e,t,i){var a,r,n,l,o,s=this;return this.format.replace(this.fre,function(){var g;return(r=arguments[1],n=arguments[3],a=s.precre.exec(r),a?(o=a[2],r=a[1]):o=!1,l=e[r],void 0===l)?"":n&&t&&t[n]?(g=t[n],g.get?t[n].get(l)||l:t[n][l]||l):(d(l)&&(i.get("numberFormatter")?l=i.get("numberFormatter")(l):l=m(l,o,i.get("numberDigitGroupCount"),i.get("numberDigitGroupSep"),i.get("numberDecimalMark"))),l)})}}),r.spformat=function(e,t){return new n(e,t)},l=function(e,t,i){return e<t?t:e>i?i:e},o=function(e,t){var i;return 2===t?(i=a.floor(e.length/2),e.length%2?e[i]:(e[i-1]+e[i])/2):e.length%2?(i=(e.length*t+t)/4,i%1?(e[a.floor(i)]+e[a.floor(i)-1])/2:e[i-1]):(i=(e.length*t+2)/4,i%1?(e[a.floor(i)]+e[a.floor(i)-1])/2:e[i-1])},s=function(e){var t;return"undefined"===e?e=void 0:"null"===e?e=null:"true"===e?e=!0:"false"===e?e=!1:(t=parseFloat(e),e==t&&(e=t)),e},g=function(e){var t,a=[];for(t=e.length;t--;)a[t]=s(e[t]);return a},p=function(e,t){var a,r,n=[];for(a=0,r=e.length;a<r;a++)e[a]!==t&&n.push(e[a]);return n},d=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},m=function(e,t,a,n,l){var o,s;for(e=(!1===t?parseFloat(e).toString():e.toFixed(t)).split(""),o=0>(o=r.inArray(".",e))?e.length:o,o<e.length&&(e[o]=l),s=o-a;0<s;s-=a)e.splice(s,0,n);return e.join("")},h=function(e,t,a){var r;for(r=t.length;r--;)if(!(a&&null===t[r])&&t[r]!==e)return!1;return!0},u=function(e){var t,a=0;for(t=e.length;t--;)a+="number"==typeof e[t]?e[t]:0;return a},f=function(e){return r.isArray(e)?e:[e]},c=function(e){var i,a;if(t.createStyleSheet)try{return void(t.createStyleSheet().cssText=e)}catch(t){a=!0}i=t.createElement("style"),i.type="text/css",t.getElementsByTagName("head")[0].appendChild(i),a?t.styleSheets[t.styleSheets.length-1].cssText=e:i["string"==typeof t.body.style.WebkitAppearance?"innerText":"innerHTML"]=e},r.fn.simpledraw=function(e,i,a,n){var l,o;if(a&&(l=this.data("_jqs_vcanvas")))return l;if(!1===r.fn.sparkline.canvas)return!1;if(void 0===r.fn.sparkline.canvas){var s=t.createElement("canvas");if(!!(s.getContext&&s.getContext("2d")))r.fn.sparkline.canvas=function(e,t,i,a){return new q(e,t,i,a)};else if(t.namespaces&&!t.namespaces.v)t.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),r.fn.sparkline.canvas=function(e,t,i){return new I(e,t,i)};else return r.fn.sparkline.canvas=!1,!1}return void 0===e&&(e=r(this).innerWidth()),void 0===i&&(i=r(this).innerHeight()),l=r.fn.sparkline.canvas(e,i,this,n),o=r(this).data("_jqs_mhandler"),o&&o.registerCanvas(l),l},r.fn.cleardraw=function(){var e=this.data("_jqs_vcanvas");e&&e.reset()},r.RangeMapClass=v=i({init:function(e){var t,i,a=[];for(t in e)e.hasOwnProperty(t)&&"string"==typeof t&&-1<t.indexOf(":")&&(i=t.split(":"),i[0]=0===i[0].length?-Infinity:parseFloat(i[0]),i[1]=0===i[1].length?1/0:parseFloat(i[1]),i[2]=e[t],a.push(i));this.map=e,this.rangelist=a},get:function(e){var t,a,r,n=this.rangelist;if((r=this.map[e])!==void 0)return r;if(n)for(t=n.length;t--;)if(a=n[t],a[0]<=e&&a[1]>=e)return a[2];return void 0}}),r.range_map=function(e){return new v(e)},x=i({init:function(e,t){var i=r(e);this.$el=i,this.options=t,this.currentPageX=0,this.currentPageY=0,this.el=e,this.splist=[],this.tooltip=null,this.over=!1,this.displayTooltips=!t.get("disableTooltips"),this.highlightEnabled=!t.get("disableHighlight")},registerSparkline:function(e){this.splist.push(e),this.over&&this.updateDisplay()},registerCanvas:function(e){var t=r(e.canvas);this.canvas=e,this.$canvas=t,t.mouseenter(r.proxy(this.mouseenter,this)),t.mouseleave(r.proxy(this.mouseleave,this)),t.click(r.proxy(this.mouseclick,this))},reset:function(e){this.splist=[],this.tooltip&&e&&(this.tooltip.remove(),this.tooltip=void 0)},mouseclick:function(t){var e=r.Event("sparklineClick");e.originalEvent=t,e.sparklines=this.splist,this.$el.trigger(e)},mouseenter:function(i){r(t.body).unbind("mousemove.jqs"),r(t.body).bind("mousemove.jqs",r.proxy(this.mousemove,this)),this.over=!0,this.currentPageX=i.pageX,this.currentPageY=i.pageY,this.currentEl=i.target,!this.tooltip&&this.displayTooltips&&(this.tooltip=new y(this.options),this.tooltip.updatePosition(i.pageX,i.pageY)),this.updateDisplay()},mouseleave:function(){r(t.body).unbind("mousemove.jqs");var e,a,n=this.splist,l=n.length,o=!1;for(this.over=!1,this.currentEl=null,this.tooltip&&(this.tooltip.remove(),this.tooltip=null),a=0;a<l;a++)e=n[a],e.clearRegionHighlight()&&(o=!0);o&&this.canvas.render()},mousemove:function(t){this.currentPageX=t.pageX,this.currentPageY=t.pageY,this.currentEl=t.target,this.tooltip&&this.tooltip.updatePosition(t.pageX,t.pageY),this.updateDisplay()},updateDisplay:function(){var e,t,a,n,l,o=this.splist,s=o.length,g=!1,p=this.$canvas.offset(),d=this.currentPageX-p.left,h=this.currentPageY-p.top;if(this.over){for(a=0;a<s;a++)t=o[a],n=t.setRegionHighlight(this.currentEl,d,h),n&&(g=!0);if(g){if(l=r.Event("sparklineRegionChange"),l.sparklines=this.splist,this.$el.trigger(l),this.tooltip){for(e="",a=0;a<s;a++)t=o[a],e+=t.getCurrentRegionTooltip();this.tooltip.setContent(e)}this.disableHighlight||this.canvas.render()}null===n&&this.mouseleave()}}}),y=i({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(e){var i,a=e.get("tooltipClassname","jqstooltip"),n=this.sizeStyle;this.container=e.get("tooltipContainer")||t.body,this.tooltipOffsetX=e.get("tooltipOffsetX",10),this.tooltipOffsetY=e.get("tooltipOffsetY",12),r("#jqssizetip").remove(),r("#jqstooltip").remove(),this.sizetip=r("<div/>",{id:"jqssizetip",style:n,class:a}),this.tooltip=r("<div/>",{id:"jqstooltip",class:a}).appendTo(this.container),i=this.tooltip.offset(),this.offsetLeft=i.left,this.offsetTop=i.top,this.hidden=!0,r(window).unbind("resize.jqs scroll.jqs"),r(window).bind("resize.jqs scroll.jqs",r.proxy(this.updateWindowDims,this)),this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=r(window).scrollTop(),this.scrollLeft=r(window).scrollLeft(),this.scrollRight=this.scrollLeft+r(window).width(),this.updatePosition()},getSize:function(e){this.sizetip.html(e).appendTo(this.container),this.width=this.sizetip.width()+1,this.height=this.sizetip.height(),this.sizetip.remove()},setContent:function(e){return e?void(this.getSize(e),this.tooltip.html(e).css({width:this.width,height:this.height,visibility:"visible"}),this.hidden&&(this.hidden=!1,this.updatePosition())):(this.tooltip.css("visibility","hidden"),void(this.hidden=!0))},updatePosition:function(e,t){if(e===void 0){if(this.mousex===void 0)return;e=this.mousex-this.offsetLeft,t=this.mousey-this.offsetTop}else this.mousex=e-=this.offsetLeft,this.mousey=t-=this.offsetTop;this.height&&this.width&&!this.hidden&&(t-=this.height+this.tooltipOffsetY,e+=this.tooltipOffsetX,t<this.scrollTop&&(t=this.scrollTop),e<this.scrollLeft?e=this.scrollLeft:e+this.width>this.scrollRight&&(e=this.scrollRight-this.width),this.tooltip.css({left:e,top:t}))},remove:function(){this.tooltip.remove(),this.sizetip.remove(),this.sizetip=this.tooltip=void 0,r(window).unbind("resize.jqs scroll.jqs")}}),W=function(){c(H)},r(W),P=[],r.fn.sparkline=function(e,a){return this.each(function(){var n,l,o=new r.fn.sparkline.options(this,a),s=r(this);if(n=function(){var i,a,n,l,g,p,d;return"html"===e||void 0===e?(d=this.getAttribute(o.get("tagValuesAttribute")),(void 0===d||null===d)&&(d=s.html()),i=d.replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(",")):i=e,a="auto"===o.get("width")?i.length*o.get("defaultPixelsPerValue"):o.get("width"),"auto"===o.get("height")?(!o.get("composite")||!r.data(this,"_jqs_vcanvas"))&&(l=t.createElement("span"),l.innerHTML="a",s.html(l),n=r(l).innerHeight()||r(l).height(),r(l).remove(),l=null):n=o.get("height"),o.get("disableInteraction")?g=!1:(g=r.data(this,"_jqs_mhandler"),g?!o.get("composite")&&g.reset():(g=new x(this,o),r.data(this,"_jqs_mhandler",g))),o.get("composite")&&!r.data(this,"_jqs_vcanvas")?void(r.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),r.data(this,"_jqs_errnotify",!0))):void(p=new r.fn.sparkline[o.get("type")](this,i,o,a,n),p.render(),g&&g.registerSparkline(p))},r(this).html()&&!o.get("disableHiddenCheck")&&r(this).is(":hidden")||!r(this).parents("body").length){if(!o.get("composite")&&r.data(this,"_jqs_pending"))for(l=P.length;l;l--)P[l-1][0]==this&&P.splice(l-1,1);P.push([this,n]),r.data(this,"_jqs_pending",!0)}else n.call(this)})},r.fn.sparkline.defaults=e(),r.sparkline_display_visible=function(){var e,t,a,n=[];for(t=0,a=P.length;t<a;t++)e=P[t][0],r(e).is(":visible")&&!r(e).parents().is(":hidden")?(P[t][1].call(e),r.data(P[t][0],"_jqs_pending",!1),n.push(t)):!r(e).closest("html").length&&!r.data(e,"_jqs_pending")&&(r.data(P[t][0],"_jqs_pending",!1),n.push(t));for(t=n.length;t;t--)P.splice(n[t-1],1)},r.fn.sparkline.options=i({init:function(e,t){var i,a,n,l;this.userOptions=t=t||{},this.tag=e,this.tagValCache={},a=r.fn.sparkline.defaults,n=a.common,this.tagOptionsPrefix=t.enableTagOptions&&(t.tagOptionsPrefix||n.tagOptionsPrefix),l=this.getTagSetting("type"),i=l===L?a[t.type||n.type]:a[l],this.mergedOptions=r.extend({},n,i,t)},getTagSetting:function(e){var t,a,r,n,l=this.tagOptionsPrefix;if(!1===l||l===void 0)return L;if(this.tagValCache.hasOwnProperty(e))t=this.tagValCache.key;else{if(t=this.tag.getAttribute(l+e),void 0===t||null===t)t=L;else if("["===t.substr(0,1))for(t=t.substr(1,t.length-2).split(","),a=t.length;a--;)t[a]=s(t[a].replace(/(^\s*)|(\s*$)/g,""));else if("{"===t.substr(0,1))for(r=t.substr(1,t.length-2).split(","),t={},a=r.length;a--;)n=r[a].split(":",2),t[n[0].replace(/(^\s*)|(\s*$)/g,"")]=s(n[1].replace(/(^\s*)|(\s*$)/g,""));else t=s(t);this.tagValCache.key=t}return t},get:function(e,t){var i,a=this.getTagSetting(e);return a===L?(i=this.mergedOptions[e])===void 0?t:i:a}}),r.fn.sparkline._base=i({disabled:!1,init:function(e,t,i,a,n){this.el=e,this.$el=r(e),this.values=t,this.options=i,this.width=a,this.height=n,this.currentRegion=void 0},initTarget:function(){var e=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),e))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return!this.disabled||(this.el.innerHTML="",!1)},getRegion:function(){},setRegionHighlight:function(e,t,i){var a,r=this.currentRegion,n=!this.options.get("disableHighlight");return t>this.canvasWidth||i>this.canvasHeight||0>t||0>i?null:(a=this.getRegion(e,t,i),r!==a&&(void 0!==r&&n&&this.removeHighlight(),this.currentRegion=a,void 0!==a&&n&&this.renderHighlight(),!0))},clearRegionHighlight:function(){return void 0!==this.currentRegion&&(this.removeHighlight(),this.currentRegion=void 0,!0)},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(){},getCurrentRegionTooltip:function(){var e,t,a,l,o,s,g,p,d,h,u,c,f,m,v=this.options,x="",y=[];if(void 0===this.currentRegion)return"";if(e=this.getCurrentRegionFields(),u=v.get("tooltipFormatter"),u)return u(this,v,e);if(v.get("tooltipChartTitle")&&(x+="<div class=\"jqs jqstitle\">"+v.get("tooltipChartTitle")+"</div>\n"),t=this.options.get("tooltipFormat"),!t)return"";if(r.isArray(t)||(t=[t]),r.isArray(e)||(e=[e]),g=this.options.get("tooltipFormatFieldlist"),p=this.options.get("tooltipFormatFieldlistKey"),g&&p){for(d=[],s=e.length;s--;)h=e[s][p],-1!=(m=r.inArray(h,g))&&(d[m]=e[s]);e=d}for(a=t.length,f=e.length,s=0;s<a;s++)for(c=t[s],"string"==typeof c&&(c=new n(c)),l=c.fclass||"jqsfield",m=0;m<f;m++)e[m].isNull&&v.get("tooltipSkipNull")||(r.extend(e[m],{prefix:v.get("tooltipPrefix"),suffix:v.get("tooltipSuffix")}),o=c.render(e[m],v.get("tooltipValueLookups"),v),y.push("<div class=\""+l+"\">"+o+"</div>"));return y.length?x+y.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(e,t){var r,n,o,s,g=t.get("highlightColor"),p=t.get("highlightLighten");if(g)return g;if(p&&(r=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(e),r)){for(o=[],n=4===e.length?16:1,s=0;3>s;s++)o[s]=l(a.round(parseInt(r[s+1],16)*n*p),0,255);return"rgb("+o.join(",")+")"}return e}}),C={changeHighlight:function(e){var t,i=this.currentRegion,a=this.target,n=this.regionShapes[i];n&&(t=this.renderRegion(i,e),r.isArray(t)||r.isArray(n)?(a.replaceWithShapes(n,t),this.regionShapes[i]=r.map(t,function(e){return e.id})):(a.replaceWithShape(n,t),this.regionShapes[i]=t.id))},render:function(){var e,t,a,n,l=this.values,o=this.target,s=this.regionShapes;if(this.cls._super.render.call(this)){for(a=l.length;a--;)if(e=this.renderRegion(a),!e)s[a]=null;else if(r.isArray(e)){for(t=[],n=e.length;n--;)e[n].append(),t.push(e[n].id);s[a]=t}else e.append(),s[a]=e.id;o.render()}}},r.fn.sparkline.line=R=i(r.fn.sparkline._base,{type:"line",init:function(e,t,i,a,r){R._super.init.call(this,e,t,i,a,r),this.vertices=[],this.regionMap=[],this.xvalues=[],this.yvalues=[],this.yminmax=[],this.hightlightSpotId=null,this.lastShapeId=null,this.initTarget()},getRegion:function(e,t){var a,r=this.regionMap;for(a=r.length;a--;)if(null!==r[a]&&t>=r[a][0]&&t<=r[a][1])return r[a][2];return void 0},getCurrentRegionFields:function(){var e=this.currentRegion;return{isNull:null===this.yvalues[e],x:this.xvalues[e],y:this.yvalues[e],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:e}},renderHighlight:function(){var e,t,i=this.currentRegion,a=this.target,r=this.vertices[i],n=this.options,l=n.get("spotRadius"),o=n.get("highlightSpotColor"),s=n.get("highlightLineColor");r&&(l&&o&&(e=a.drawCircle(r[0],r[1],l,void 0,o),this.highlightSpotId=e.id,a.insertAfterShape(this.lastShapeId,e)),s&&(t=a.drawLine(r[0],this.canvasTop,r[0],this.canvasTop+this.canvasHeight,s),this.highlightLineId=t.id,a.insertAfterShape(this.lastShapeId,t)))},removeHighlight:function(){var e=this.target;this.highlightSpotId&&(e.removeShapeId(this.highlightSpotId),this.highlightSpotId=null),this.highlightLineId&&(e.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){var e,t,r,n,l,o=this.values,s=o.length,g=this.xvalues,p=this.yvalues,d=this.yminmax;for(e=0;e<s;e++)t=o[e],r="string"==typeof o[e],n="object"==typeof o[e]&&o[e]instanceof Array,l=r&&o[e].split(":"),r&&2===l.length?(g.push(+l[0]),p.push(+l[1]),d.push(+l[1])):n?(g.push(t[0]),p.push(t[1]),d.push(t[1])):(g.push(e),null===o[e]||"null"===o[e]?p.push(null):(p.push(+t),d.push(+t)));this.options.get("xvalues")&&(g=this.options.get("xvalues")),this.maxy=this.maxyorg=a.max.apply(a,d),this.miny=this.minyorg=a.min.apply(a,d),this.maxx=a.max.apply(a,g),this.minx=a.min.apply(a,g),this.xvalues=g,this.yvalues=p,this.yminmax=d},processRangeOptions:function(){var e=this.options,t=e.get("normalRangeMin"),i=e.get("normalRangeMax");t!==void 0&&(t<this.miny&&(this.miny=t),i>this.maxy&&(this.maxy=i)),e.get("chartRangeMin")!==void 0&&(e.get("chartRangeClip")||e.get("chartRangeMin")<this.miny)&&(this.miny=e.get("chartRangeMin")),e.get("chartRangeMax")!==void 0&&(e.get("chartRangeClip")||e.get("chartRangeMax")>this.maxy)&&(this.maxy=e.get("chartRangeMax")),e.get("chartRangeMinX")!==void 0&&(e.get("chartRangeClipX")||e.get("chartRangeMinX")<this.minx)&&(this.minx=e.get("chartRangeMinX")),e.get("chartRangeMaxX")!==void 0&&(e.get("chartRangeClipX")||e.get("chartRangeMaxX")>this.maxx)&&(this.maxx=e.get("chartRangeMaxX"))},drawNormalRange:function(e,t,i,r,n){var l=this.options.get("normalRangeMin"),o=this.options.get("normalRangeMax"),s=t+a.round(i-i*((o-this.miny)/n)),g=a.round(i*(o-l)/n);this.target.drawRect(e,s,r,g,void 0,this.options.get("normalRangeColor")).append()},render:function(){var e,t,r,n,l,o,s,g,p,d,h,u,c,f,m,C,S,b,w,k,M,_,H,W,T,j=this.options,q=this.target,I=this.canvasWidth,P=this.canvasHeight,L=this.vertices,A=j.get("spotRadius"),B=this.regionMap;if(R._super.render.call(this)&&(this.scanValues(),this.processRangeOptions(),H=this.xvalues,W=this.yvalues,this.yminmax.length&&!(2>this.yvalues.length))){for(n=l=0,e=0==this.maxx-this.minx?1:this.maxx-this.minx,t=0==this.maxy-this.miny?1:this.maxy-this.miny,r=this.yvalues.length-1,A&&(I<4*A||P<4*A)&&(A=0),A&&(M=j.get("highlightSpotColor")&&!j.get("disableInteraction"),(M||j.get("minSpotColor")||j.get("spotColor")&&W[r]===this.miny)&&(P-=a.ceil(A)),(M||j.get("maxSpotColor")||j.get("spotColor")&&W[r]===this.maxy)&&(P-=a.ceil(A),n+=a.ceil(A)),(M||(j.get("minSpotColor")||j.get("maxSpotColor"))&&(W[0]===this.miny||W[0]===this.maxy))&&(l+=a.ceil(A),I-=a.ceil(A)),(M||j.get("spotColor")||j.get("minSpotColor")||j.get("maxSpotColor")&&(W[r]===this.miny||W[r]===this.maxy))&&(I-=a.ceil(A))),P--,void 0===j.get("normalRangeMin")||j.get("drawNormalOnTop")||this.drawNormalRange(l,n,P,I,t),s=[],g=[s],f=m=null,C=W.length,T=0;T<C;T++)p=H[T],h=H[T+1],d=W[T],u=l+a.round((p-this.minx)*(I/e)),c=T<C-1?l+a.round((h-this.minx)*(I/e)):I,m=u+(c-u)/2,B[T]=[f||0,m,T],f=m,null===d?T&&(null!==W[T-1]&&(s=[],g.push(s)),L.push(null)):(d<this.miny&&(d=this.miny),d>this.maxy&&(d=this.maxy),!s.length&&s.push([u,n+P]),o=[u,n+a.round(P-P*((d-this.miny)/t))],s.push(o),L.push(o));for(S=[],b=[],w=g.length,T=0;T<w;T++)s=g[T],s.length&&(j.get("fillColor")&&(s.push([s[s.length-1][0],n+P]),b.push(s.slice(0)),s.pop()),2<s.length&&(s[0]=[s[0][0],s[1][1]]),S.push(s));for(w=b.length,T=0;T<w;T++)q.drawShape(b[T],j.get("fillColor"),j.get("fillColor")).append();for(void 0!==j.get("normalRangeMin")&&j.get("drawNormalOnTop")&&this.drawNormalRange(l,n,P,I,t),w=S.length,T=0;T<w;T++)q.drawShape(S[T],j.get("lineColor"),void 0,j.get("lineWidth")).append();if(A&&j.get("valueSpots"))for(k=j.get("valueSpots"),void 0===k.get&&(k=new v(k)),T=0;T<C;T++)_=k.get(W[T]),_&&q.drawCircle(l+a.round((H[T]-this.minx)*(I/e)),n+a.round(P-P*((W[T]-this.miny)/t)),A,void 0,_).append();A&&j.get("spotColor")&&null!==W[r]&&q.drawCircle(l+a.round((H[H.length-1]-this.minx)*(I/e)),n+a.round(P-P*((W[r]-this.miny)/t)),A,void 0,j.get("spotColor")).append(),this.lastShapeId=q.getLastShapeId(),this.canvasTop=n,q.render()}}}),r.fn.sparkline.bar=S=i(r.fn.sparkline._base,C,{type:"bar",init:function(e,t,n,o,d){var h,u,c,f,m,x,y,C,R,b,w,k,M,_,H,W,T,q,I,P,L,A,B=parseInt(n.get("barWidth"),10),F=parseInt(n.get("barSpacing"),10),O=n.get("chartRangeMin"),V=n.get("chartRangeMax"),X=n.get("chartRangeClip"),z=1/0,E=-Infinity;for(S._super.init.call(this,e,t,n,o,d),x=0,y=t.length;x<y;x++)P=t[x],h="string"==typeof P&&-1<P.indexOf(":"),(h||r.isArray(P))&&(H=!0,h&&(P=t[x]=g(P.split(":"))),P=p(P,null),u=a.min.apply(a,P),c=a.max.apply(a,P),u<z&&(z=u),c>E&&(E=c));this.stacked=H,this.regionShapes={},this.barWidth=B,this.barSpacing=F,this.totalBarWidth=B+F,this.width=o=t.length*B+(t.length-1)*F,this.initTarget(),X&&(M=O===void 0?-Infinity:O,_=V===void 0?1/0:V),m=[],f=H?[]:m;var D=[],Y=[];for(x=0,y=t.length;x<y;x++)if(H)for(W=t[x],t[x]=I=[],D[x]=0,f[x]=Y[x]=0,(T=0,q=W.length);T<q;T++)P=I[T]=X?l(W[T],M,_):W[T],null!==P&&(0<P&&(D[x]+=P),0>z&&0<E?0>P?Y[x]+=a.abs(P):f[x]+=P:f[x]+=a.abs(P-(0>P?E:z)),m.push(P));else P=X?l(t[x],M,_):t[x],P=t[x]=s(P),null!==P&&m.push(P);this.max=k=a.max.apply(a,m),this.min=w=a.min.apply(a,m),this.stackMax=E=H?a.max.apply(a,D):k,this.stackMin=z=H?a.min.apply(a,m):w,n.get("chartRangeMin")!==void 0&&(n.get("chartRangeClip")||n.get("chartRangeMin")<w)&&(w=n.get("chartRangeMin")),n.get("chartRangeMax")!==void 0&&(n.get("chartRangeClip")||n.get("chartRangeMax")>k)&&(k=n.get("chartRangeMax")),this.zeroAxis=R=n.get("zeroAxis",!0),b=0>=w&&0<=k&&R?0:!1==R?w:0<w?w:k,this.xaxisOffset=b,C=H?a.max.apply(a,f)+a.max.apply(a,Y):k-w,this.canvasHeightEf=R&&0>w?this.canvasHeight-2:this.canvasHeight-1,w<b?(A=H&&0<=k?E:k,L=(A-b)/C*this.canvasHeight,L!==a.ceil(L)&&(this.canvasHeightEf-=2,L=a.ceil(L))):L=this.canvasHeight,this.yoffset=L,r.isArray(n.get("colorMap"))?(this.colorMapByIndex=n.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=n.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===void 0&&(this.colorMapByValue=new v(this.colorMapByValue))),this.range=C},getRegion:function(e,t){var i=a.floor(t/this.totalBarWidth);return 0>i||i>=this.values.length?void 0:i},getCurrentRegionFields:function(){var e,t,a=this.currentRegion,r=f(this.values[a]),n=[];for(t=r.length;t--;)e=r[t],n.push({isNull:null===e,value:e,color:this.calcColor(t,e,a),offset:a});return n},calcColor:function(e,t,i){var a,n,l=this.colorMapByIndex,o=this.colorMapByValue,s=this.options;return a=this.stacked?s.get("stackedBarColor"):0>t?s.get("negBarColor"):s.get("barColor"),0===t&&void 0!==s.get("zeroColor")&&(a=s.get("zeroColor")),o&&(n=o.get(t))?a=n:l&&l.length>i&&(a=l[i]),r.isArray(a)?a[e%a.length]:a},renderRegion:function(e,t){var n,l,o,s,g,p,d,u,c,f,m=this.values[e],v=this.options,C=this.xaxisOffset,R=[],S=this.range,b=this.stacked,w=this.target,k=e*this.totalBarWidth,x=this.canvasHeightEf,M=this.yoffset;if(m=r.isArray(m)?m:[m],d=m.length,u=m[0],s=h(null,m),f=h(C,m,!0),s)return v.get("nullColor")?(o=t?v.get("nullColor"):this.calcHighlightColor(v.get("nullColor"),v),n=0<M?M-1:M,w.drawRect(k,n,this.barWidth-1,0,o,o)):void 0;for(g=M,p=0;p<d;p++){if(u=m[p],b&&u===C){if(!f||c)continue;c=!0}l=0<S?a.floor(x*(a.abs(u-C)/S))+1:1,u<C||u===C&&0===M?(n=g,g+=l):(n=M-l,M-=l),o=this.calcColor(p,u,e),t&&(o=this.calcHighlightColor(o,v)),R.push(w.drawRect(k,n,this.barWidth-1,l-1,o,o))}return 1===R.length?R[0]:R}}),r.fn.sparkline.tristate=b=i(r.fn.sparkline._base,C,{type:"tristate",init:function(e,t,i,a,n){var l=parseInt(i.get("barWidth"),10),o=parseInt(i.get("barSpacing"),10);b._super.init.call(this,e,t,i,a,n),this.regionShapes={},this.barWidth=l,this.barSpacing=o,this.totalBarWidth=l+o,this.values=r.map(t,Number),this.width=a=t.length*l+(t.length-1)*o,r.isArray(i.get("colorMap"))?(this.colorMapByIndex=i.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=i.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===void 0&&(this.colorMapByValue=new v(this.colorMapByValue))),this.initTarget()},getRegion:function(e,t){return a.floor(t/this.totalBarWidth)},getCurrentRegionFields:function(){var e=this.currentRegion;return{isNull:this.values[e]===void 0,value:this.values[e],color:this.calcColor(this.values[e],e),offset:e}},calcColor:function(e,t){var i,a,r=this.values,n=this.options,l=this.colorMapByIndex,o=this.colorMapByValue;return i=o&&(a=o.get(e))?a:l&&l.length>t?l[t]:0>r[t]?n.get("negBarColor"):0<r[t]?n.get("posBarColor"):n.get("zeroBarColor"),i},renderRegion:function(e,t){var i,r,n,l,o,s,g=this.values,p=this.options,d=this.target;if(i=d.pixelHeight,n=a.round(i/2),l=e*this.totalBarWidth,0>g[e]?(o=n,r=n-1):0<g[e]?(o=0,r=n-1):(o=n-1,r=2),s=this.calcColor(g[e],e),null!==s)return t&&(s=this.calcHighlightColor(s,p)),d.drawRect(l,o,this.barWidth-1,r-1,s,s)}}),r.fn.sparkline.discrete=w=i(r.fn.sparkline._base,C,{type:"discrete",init:function(e,t,i,n,l){w._super.init.call(this,e,t,i,n,l),this.regionShapes={},this.values=t=r.map(t,Number),this.min=a.min.apply(a,t),this.max=a.max.apply(a,t),this.range=this.max-this.min,this.width=n="auto"===i.get("width")?2*t.length:this.width,this.interval=a.floor(n/t.length),this.itemWidth=n/t.length,i.get("chartRangeMin")!==void 0&&(i.get("chartRangeClip")||i.get("chartRangeMin")<this.min)&&(this.min=i.get("chartRangeMin")),i.get("chartRangeMax")!==void 0&&(i.get("chartRangeClip")||i.get("chartRangeMax")>this.max)&&(this.max=i.get("chartRangeMax")),this.initTarget(),this.target&&(this.lineHeight="auto"===i.get("lineHeight")?a.round(.3*this.canvasHeight):i.get("lineHeight"))},getRegion:function(e,t){return a.floor(t/this.itemWidth)},getCurrentRegionFields:function(){var e=this.currentRegion;return{isNull:this.values[e]===void 0,value:this.values[e],offset:e}},renderRegion:function(e,t){var i,r,n,o,s=this.values,g=this.options,p=this.min,d=this.max,h=this.range,u=this.interval,c=this.target,f=this.canvasHeight,m=this.lineHeight,v=f-m;return r=l(s[e],p,d),o=e*u,i=a.round(v-v*((r-p)/h)),n=g.get("thresholdColor")&&r<g.get("thresholdValue")?g.get("thresholdColor"):g.get("lineColor"),t&&(n=this.calcHighlightColor(n,g)),c.drawLine(o,i,o,i+m,n)}}),r.fn.sparkline.bullet=k=i(r.fn.sparkline._base,{type:"bullet",init:function(e,t,i,r,n){var l,o,s;k._super.init.call(this,e,t,i,r,n),this.values=t=g(t),s=t.slice(),s[0]=null===s[0]?s[2]:s[0],s[1]=null===t[1]?s[2]:s[1],l=a.min.apply(a,t),o=a.max.apply(a,t),l=void 0===i.get("base")?0>l?l:0:i.get("base"),this.min=l,this.max=o,this.range=o-l,this.shapes={},this.valueShapes={},this.regiondata={},this.width=r="auto"===i.get("width")?"4.0em":r,this.target=this.$el.simpledraw(r,n,i.get("composite")),t.length||(this.disabled=!0),this.initTarget()},getRegion:function(e,t,i){var a=this.target.getShapeAt(e,t,i);return a!==void 0&&this.shapes[a]!==void 0?this.shapes[a]:void 0},getCurrentRegionFields:function(){var e=this.currentRegion;return{fieldkey:e.substr(0,1),value:this.values[e.substr(1)],region:e}},changeHighlight:function(e){var t,i=this.currentRegion,a=this.valueShapes[i];switch(delete this.shapes[a],i.substr(0,1)){case"r":t=this.renderRange(i.substr(1),e);break;case"p":t=this.renderPerformance(e);break;case"t":t=this.renderTarget(e);}this.valueShapes[i]=t.id,this.shapes[t.id]=i,this.target.replaceWithShape(a,t)},renderRange:function(e,t){var i=this.values[e],r=a.round(this.canvasWidth*((i-this.min)/this.range)),n=this.options.get("rangeColors")[e-2];return t&&(n=this.calcHighlightColor(n,this.options)),this.target.drawRect(0,0,r-1,this.canvasHeight-1,n,n)},renderPerformance:function(e){var t=this.values[1],i=a.round(this.canvasWidth*((t-this.min)/this.range)),r=this.options.get("performanceColor");return e&&(r=this.calcHighlightColor(r,this.options)),this.target.drawRect(0,a.round(.3*this.canvasHeight),i-1,a.round(.4*this.canvasHeight)-1,r,r)},renderTarget:function(e){var t=this.values[0],i=a.round(this.canvasWidth*((t-this.min)/this.range)-this.options.get("targetWidth")/2),r=a.round(.1*this.canvasHeight),n=this.canvasHeight-2*r,l=this.options.get("targetColor");return e&&(l=this.calcHighlightColor(l,this.options)),this.target.drawRect(i,r,this.options.get("targetWidth")-1,n-1,l,l)},render:function(){var e,t,a=this.values.length,r=this.target;if(k._super.render.call(this)){for(e=2;e<a;e++)t=this.renderRange(e).append(),this.shapes[t.id]="r"+e,this.valueShapes["r"+e]=t.id;null!==this.values[1]&&(t=this.renderPerformance().append(),this.shapes[t.id]="p1",this.valueShapes.p1=t.id),null!==this.values[0]&&(t=this.renderTarget().append(),this.shapes[t.id]="t0",this.valueShapes.t0=t.id),r.render()}}}),r.fn.sparkline.pie=M=i(r.fn.sparkline._base,{type:"pie",init:function(e,t,n,l,o){var s,g=0;if(M._super.init.call(this,e,t,n,l,o),this.shapes={},this.valueShapes={},this.values=t=r.map(t,Number),"auto"===n.get("width")&&(this.width=this.height),0<t.length)for(s=t.length;s--;)g+=t[s];this.total=g,this.initTarget(),this.radius=a.floor(a.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(e,t,i){var a=this.target.getShapeAt(e,t,i);return a!==void 0&&this.shapes[a]!==void 0?this.shapes[a]:void 0},getCurrentRegionFields:function(){var e=this.currentRegion;return{isNull:this.values[e]===void 0,value:this.values[e],percent:100*(this.values[e]/this.total),color:this.options.get("sliceColors")[e%this.options.get("sliceColors").length],offset:e}},changeHighlight:function(e){var t=this.currentRegion,i=this.renderSlice(t,e),a=this.valueShapes[t];delete this.shapes[a],this.target.replaceWithShape(a,i),this.valueShapes[t]=i.id,this.shapes[i.id]=t},renderSlice:function(e,t){var r,n,l,o,s,g=this.target,p=this.options,d=this.radius,h=p.get("borderWidth"),u=p.get("offset"),c=2*a.PI,f=this.values,m=this.total,v=u?2*a.PI*(u/360):0;for(o=f.length,l=0;l<o;l++){if(r=v,n=v,0<m&&(n=v+c*(f[l]/m)),e===l)return s=p.get("sliceColors")[l%p.get("sliceColors").length],t&&(s=this.calcHighlightColor(s,p)),g.drawPieSlice(d,d,d-h,r,n,void 0,s);v=n}},render:function(){var e,t,r=this.target,n=this.values,l=this.options,o=this.radius,s=l.get("borderWidth");if(M._super.render.call(this)){for(s&&r.drawCircle(o,o,a.floor(o-s/2),l.get("borderColor"),void 0,s).append(),t=n.length;t--;)n[t]&&(e=this.renderSlice(t).append(),this.valueShapes[t]=e.id,this.shapes[e.id]=t);r.render()}}}),r.fn.sparkline.box=_=i(r.fn.sparkline._base,{type:"box",init:function(e,t,i,a,n){_._super.init.call(this,e,t,i,a,n),this.values=r.map(t,Number),this.width="auto"===i.get("width")?"4.0em":a,this.initTarget(),this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var e=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];return void 0!==this.loutlier&&e.push({field:"lo",value:this.loutlier}),void 0!==this.routlier&&e.push({field:"ro",value:this.routlier}),void 0!==this.lwhisker&&e.push({field:"lw",value:this.lwhisker}),void 0!==this.rwhisker&&e.push({field:"rw",value:this.rwhisker}),e},render:function(){var e,t,r,n,l,s,g,p,d,h,u,c=this.target,f=this.values,m=f.length,v=this.options,x=this.canvasWidth,y=this.canvasHeight,C=v.get("chartRangeMin")===void 0?a.min.apply(a,f):v.get("chartRangeMin"),R=v.get("chartRangeMax")===void 0?a.max.apply(a,f):v.get("chartRangeMax"),S=0;if(_._super.render.call(this)){if(v.get("raw"))v.get("showOutliers")&&5<f.length?(t=f[0],e=f[1],n=f[2],l=f[3],s=f[4],g=f[5],p=f[6]):(e=f[0],n=f[1],l=f[2],s=f[3],g=f[4]);else if(f.sort(function(e,t){return e-t}),n=o(f,1),l=o(f,2),s=o(f,3),r=s-n,v.get("showOutliers")){for(e=g=void 0,d=0;d<m;d++)void 0===e&&f[d]>n-r*v.get("outlierIQR")&&(e=f[d]),f[d]<s+r*v.get("outlierIQR")&&(g=f[d]);t=f[0],p=f[m-1]}else e=f[0],g=f[m-1];this.quartiles=[n,l,s],this.lwhisker=e,this.rwhisker=g,this.loutlier=t,this.routlier=p,u=x/(R-C+1),v.get("showOutliers")&&(S=a.ceil(v.get("spotRadius")),x-=2*a.ceil(v.get("spotRadius")),u=x/(R-C+1),t<e&&c.drawCircle((t-C)*u+S,y/2,v.get("spotRadius"),v.get("outlierLineColor"),v.get("outlierFillColor")).append(),p>g&&c.drawCircle((p-C)*u+S,y/2,v.get("spotRadius"),v.get("outlierLineColor"),v.get("outlierFillColor")).append()),c.drawRect(a.round((n-C)*u+S),a.round(.1*y),a.round((s-n)*u),a.round(.8*y),v.get("boxLineColor"),v.get("boxFillColor")).append(),c.drawLine(a.round((e-C)*u+S),a.round(y/2),a.round((n-C)*u+S),a.round(y/2),v.get("lineColor")).append(),c.drawLine(a.round((e-C)*u+S),a.round(y/4),a.round((e-C)*u+S),a.round(y-y/4),v.get("whiskerColor")).append(),c.drawLine(a.round((g-C)*u+S),a.round(y/2),a.round((s-C)*u+S),a.round(y/2),v.get("lineColor")).append(),c.drawLine(a.round((g-C)*u+S),a.round(y/4),a.round((g-C)*u+S),a.round(y-y/4),v.get("whiskerColor")).append(),c.drawLine(a.round((l-C)*u+S),a.round(.1*y),a.round((l-C)*u+S),a.round(.9*y),v.get("medianColor")).append(),v.get("target")&&(h=a.ceil(v.get("spotRadius")),c.drawLine(a.round((v.get("target")-C)*u+S),a.round(y/2-h),a.round((v.get("target")-C)*u+S),a.round(y/2+h),v.get("targetColor")).append(),c.drawLine(a.round((v.get("target")-C)*u+S-h),a.round(y/2),a.round((v.get("target")-C)*u+S+h),a.round(y/2),v.get("targetColor")).append()),c.render()}}}),T=i({init:function(e,t,i,a){this.target=e,this.id=t,this.type=i,this.args=a},append:function(){return this.target.appendShape(this),this}}),j=i({_pxregex:/(\d+)(px)?\s*$/i,init:function(e,t,i){e&&(this.width=e,this.height=t,this.target=i,this.lastShapeId=null,i[0]&&(i=i[0]),r.data(i,"_jqs_vcanvas",this))},drawLine:function(e,t,i,a,r,n){return this.drawShape([[e,t],[i,a]],r,n)},drawShape:function(e,t,i,a){return this._genShape("Shape",[e,t,i,a])},drawCircle:function(e,t,i,a,r,n){return this._genShape("Circle",[e,t,i,a,r,n])},drawPieSlice:function(e,t,i,a,r,n,l){return this._genShape("PieSlice",[e,t,i,a,r,n,l])},drawRect:function(e,t,i,a,r,n){return this._genShape("Rect",[e,t,i,a,r,n])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(e,t){r(t).html(e)},_calculatePixelDims:function(e,t,i){var a;a=this._pxregex.exec(t),this.pixelHeight=a?a[1]:r(i).height(),a=this._pxregex.exec(e),this.pixelWidth=a?a[1]:r(i).width()},_genShape:function(e,t){var i=A++;return t.unshift(i),new T(this,i,e,t)},appendShape:function(){alert("appendShape not implemented")},replaceWithShape:function(){alert("replaceWithShape not implemented")},insertAfterShape:function(){alert("insertAfterShape not implemented")},removeShapeId:function(){alert("removeShapeId not implemented")},getShapeAt:function(){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}}),q=i(j,{init:function(e,i,a,n){q._super.init.call(this,e,i,a),this.canvas=t.createElement("canvas"),a[0]&&(a=a[0]),r.data(a,"_jqs_vcanvas",this),r(this.canvas).css({display:"inline-block",width:e,height:i,verticalAlign:"top"}),this._insert(this.canvas,a),this._calculatePixelDims(e,i,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,this.interact=n,this.shapes={},this.shapeseq=[],this.currentTargetShapeId=void 0,r(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(e,t,i){var a=this.canvas.getContext("2d");return void 0!==e&&(a.strokeStyle=e),a.lineWidth=void 0===i?1:i,void 0!==t&&(a.fillStyle=t),a},reset:function(){var e=this._getContext();e.clearRect(0,0,this.pixelWidth,this.pixelHeight),this.shapes={},this.shapeseq=[],this.currentTargetShapeId=void 0},_drawShape:function(e,t,a,r,n){var l,o,s=this._getContext(a,r,n);for(s.beginPath(),s.moveTo(t[0][0]+.5,t[0][1]+.5),(l=1,o=t.length);l<o;l++)s.lineTo(t[l][0]+.5,t[l][1]+.5);a!==void 0&&s.stroke(),r!==void 0&&s.fill(),this.targetX!==void 0&&this.targetY!==void 0&&s.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=e)},_drawCircle:function(e,t,i,r,n,l,o){var s=this._getContext(n,l,o);s.beginPath(),s.arc(t,i,r,0,2*a.PI,!1),this.targetX!==void 0&&this.targetY!==void 0&&s.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=e),n!==void 0&&s.stroke(),l!==void 0&&s.fill()},_drawPieSlice:function(e,t,i,a,r,n,l,o){var s=this._getContext(l,o);s.beginPath(),s.moveTo(t,i),s.arc(t,i,a,r,n,!1),s.lineTo(t,i),s.closePath(),l!==void 0&&s.stroke(),o&&s.fill(),this.targetX!==void 0&&this.targetY!==void 0&&s.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=e)},_drawRect:function(e,t,i,a,r,n,l){return this._drawShape(e,[[t,i],[t+a,i],[t+a,i+r],[t,i+r],[t,i]],n,l)},appendShape:function(e){return this.shapes[e.id]=e,this.shapeseq.push(e.id),this.lastShapeId=e.id,e.id},replaceWithShape:function(e,t){var a,r=this.shapeseq;for(this.shapes[t.id]=t,a=r.length;a--;)r[a]==e&&(r[a]=t.id);delete this.shapes[e]},replaceWithShapes:function(e,t){var a,r,n,l=this.shapeseq,o={};for(r=e.length;r--;)o[e[r]]=!0;for(r=l.length;r--;)a=l[r],o[a]&&(l.splice(r,1),delete this.shapes[a],n=r);for(r=t.length;r--;)l.splice(n,0,t[r].id),this.shapes[t[r].id]=t[r]},insertAfterShape:function(e,t){var a,r=this.shapeseq;for(a=r.length;a--;)if(r[a]===e)return r.splice(a+1,0,t.id),void(this.shapes[t.id]=t)},removeShapeId:function(e){var t,a=this.shapeseq;for(t=a.length;t--;)if(a[t]===e){a.splice(t,1);break}delete this.shapes[e]},getShapeAt:function(e,t,i){return this.targetX=t,this.targetY=i,this.render(),this.currentTargetShapeId},render:function(){var e,t,a,r=this.shapeseq,n=this.shapes,l=r.length,o=this._getContext();for(o.clearRect(0,0,this.pixelWidth,this.pixelHeight),a=0;a<l;a++)e=r[a],t=n[e],this["_draw"+t.type].apply(this,t.args);this.interact||(this.shapes={},this.shapeseq=[])}}),I=i(j,{init:function(e,i,a){var n;I._super.init.call(this,e,i,a),a[0]&&(a=a[0]),r.data(a,"_jqs_vcanvas",this),this.canvas=t.createElement("span"),r(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:e,height:i,margin:"0px",padding:"0px",verticalAlign:"top"}),this._insert(this.canvas,a),this._calculatePixelDims(e,i,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,n="<v:group coordorigin=\"0 0\" coordsize=\""+this.pixelWidth+" "+this.pixelHeight+"\" style=\"position:absolute;top:0;left:0;width:"+this.pixelWidth+"px;height="+this.pixelHeight+"px;\"></v:group>",this.canvas.insertAdjacentHTML("beforeEnd",n),this.group=r(this.canvas).children()[0],this.rendered=!1,this.prerender=""},_drawShape:function(e,t,a,r,n){var l,o,s,g,p,d,h,u=[];for(h=0,d=t.length;h<d;h++)u[h]=""+t[h][0]+","+t[h][1];return l=u.splice(0,1),n=void 0===n?1:n,o=void 0===a?" stroked=\"false\" ":" strokeWeight=\""+n+"px\" strokeColor=\""+a+"\" ",s=void 0===r?" filled=\"false\"":" fillColor=\""+r+"\" filled=\"true\" ",g=u[0]===u[u.length-1]?"x ":"",p="<v:shape coordorigin=\"0 0\" coordsize=\""+this.pixelWidth+" "+this.pixelHeight+"\"  id=\"jqsshape"+e+"\" "+o+s+" style=\"position:absolute;left:0px;top:0px;height:"+this.pixelHeight+"px;width:"+this.pixelWidth+"px;padding:0px;margin:0px;\"  path=\"m "+l+" l "+u.join(", ")+" "+g+"e\"> </v:shape>",p},_drawCircle:function(e,t,i,a,r,n,l){var o,s,g;return t-=a,i-=a,o=void 0===r?" stroked=\"false\" ":" strokeWeight=\""+l+"px\" strokeColor=\""+r+"\" ",s=void 0===n?" filled=\"false\"":" fillColor=\""+n+"\" filled=\"true\" ",g="<v:oval  id=\"jqsshape"+e+"\" "+o+s+" style=\"position:absolute;top:"+i+"px; left:"+t+"px; width:"+2*a+"px; height:"+2*a+"px\"></v:oval>",g},_drawPieSlice:function(e,t,i,r,n,l,o,s){var g,p,d,h,u,c,f,m;if(n===l)return"";if(l-n==2*a.PI&&(n=0,l=2*a.PI),p=t+a.round(a.cos(n)*r),d=i+a.round(a.sin(n)*r),h=t+a.round(a.cos(l)*r),u=i+a.round(a.sin(l)*r),p==h&&d===u){if(l-n<a.PI)return"";p=h=t+r,d=u=i}return p===h&&d===u&&l-n<a.PI?"":(g=[t-r,i-r,t+r,i+r,p,d,h,u],c=void 0===o?" stroked=\"false\" ":" strokeWeight=\"1px\" strokeColor=\""+o+"\" ",f=void 0===s?" filled=\"false\"":" fillColor=\""+s+"\" filled=\"true\" ",m="<v:shape coordorigin=\"0 0\" coordsize=\""+this.pixelWidth+" "+this.pixelHeight+"\"  id=\"jqsshape"+e+"\" "+c+f+" style=\"position:absolute;left:0px;top:0px;height:"+this.pixelHeight+"px;width:"+this.pixelWidth+"px;padding:0px;margin:0px;\"  path=\"m "+t+","+i+" wa "+g.join(", ")+" x e\"> </v:shape>",m)},_drawRect:function(e,t,i,a,r,n,l){return this._drawShape(e,[[t,i],[t,i+r],[t+a,i+r],[t+a,i],[t,i]],n,l)},reset:function(){this.group.innerHTML=""},appendShape:function(e){var t=this["_draw"+e.type].apply(this,e.args);return this.rendered?this.group.insertAdjacentHTML("beforeEnd",t):this.prerender+=t,this.lastShapeId=e.id,e.id},replaceWithShape:function(e,t){var i=r("#jqsshape"+e),a=this["_draw"+t.type].apply(this,t.args);i[0].outerHTML=a},replaceWithShapes:function(e,t){var a,n=r("#jqsshape"+e[0]),l="",o=t.length;for(a=0;a<o;a++)l+=this["_draw"+t[a].type].apply(this,t[a].args);for(n[0].outerHTML=l,a=1;a<e.length;a++)r("#jqsshape"+e[a]).remove()},insertAfterShape:function(e,t){var i=r("#jqsshape"+e),a=this["_draw"+t.type].apply(this,t.args);i[0].insertAdjacentHTML("afterEnd",a)},removeShapeId:function(e){var t=r("#jqsshape"+e);this.group.removeChild(t[0])},getShapeAt:function(e){var t=e.id.substr(8);return t},render:function(){this.rendered||(this.group.innerHTML=this.prerender,this.rendered=!0)}})})})(document,Math);